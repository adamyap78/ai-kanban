<!-- Single Comment Item -->
<div id="comment-<%= comment.id %>" class="border-l-4 border-gray-200 pl-3 py-2 space-y-2">
    <!-- Comment Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
            <% if (comment.user.avatarUrl) { %>
                <img src="<%= comment.user.avatarUrl %>" 
                     alt="<%= comment.user.name %>" 
                     class="w-6 h-6 rounded-full">
            <% } else { %>
                <div class="w-6 h-6 rounded-full bg-primary text-primary-content text-xs flex items-center justify-center">
                    <%= comment.user.name.charAt(0).toUpperCase() %>
                </div>
            <% } %>
            <span class="font-medium text-sm"><%= comment.user.name %></span>
            <span class="text-xs text-gray-500">
                <%= new Date(comment.createdAt).toLocaleDateString() %> 
                <%= new Date(comment.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
            </span>
            <% if (comment.createdAt.getTime() !== comment.updatedAt.getTime()) { %>
                <span class="text-xs text-gray-400">(edited)</span>
            <% } %>
        </div>
        
        <!-- Comment Actions (only show for comment owner) -->
        <% if (locals.user && comment.userId === user.id) { %>
            <div class="dropdown dropdown-left">
                <div tabindex="0" role="button" class="btn btn-ghost btn-xs">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01"></path>
                    </svg>
                </div>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li>
                        <a href="#" onclick="editComment('<%= comment.id %>')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Edit
                        </a>
                    </li>
                    <li>
                        <a href="#" 
                           hx-delete="/cards/<%= comment.cardId %>/comments/<%= comment.id %>"
                           hx-target="#comment-<%= comment.id %>"
                           hx-swap="outerHTML"
                           hx-confirm="Are you sure you want to delete this comment?"
                           class="text-error">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            Delete
                        </a>
                    </li>
                </ul>
            </div>
        <% } %>
    </div>
    
    <!-- Comment Content -->
    <div id="comment-content-<%= comment.id %>" class="text-sm text-gray-700 whitespace-pre-wrap">
        <%= comment.content %>
    </div>
    
    <!-- Edit Form (initially hidden) -->
    <div id="comment-edit-<%= comment.id %>" class="hidden space-y-2">
        <form hx-put="/cards/<%= comment.cardId %>/comments/<%= comment.id %>"
              hx-target="#comment-<%= comment.id %>"
              hx-swap="outerHTML"
              class="space-y-2">
            <textarea name="content" 
                      class="textarea textarea-bordered w-full h-20" 
                      required
                      maxlength="2000"><%= comment.content %></textarea>
            <div class="flex gap-2">
                <button type="submit" class="btn btn-primary btn-xs">Save</button>
                <button type="button" 
                        onclick="cancelEditComment('<%= comment.id %>')" 
                        class="btn btn-ghost btn-xs">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    function editComment(commentId) {
        document.getElementById('comment-content-' + commentId).classList.add('hidden');
        document.getElementById('comment-edit-' + commentId).classList.remove('hidden');
    }
    
    function cancelEditComment(commentId) {
        document.getElementById('comment-content-' + commentId).classList.remove('hidden');
        document.getElementById('comment-edit-' + commentId).classList.add('hidden');
    }
</script>