<!-- Single Comment Item -->
<div id="comment-<%= comment.id %>" class="py-2 border-b border-gray-100 last:border-b-0">
    <div class="flex space-x-2">
        <!-- Small Avatar -->
        <div class="flex-shrink-0">
            <% if (comment.user.avatarUrl) { %>
                <img src="<%= comment.user.avatarUrl %>" 
                     alt="<%= comment.user.name %>" 
                     class="w-6 h-6 rounded-full">
            <% } else { %>
                <div class="w-6 h-6 rounded-full bg-primary text-primary-content text-xs font-medium flex items-center justify-center">
                    <%= comment.user.name.charAt(0).toUpperCase() %>
                </div>
            <% } %>
        </div>
        
        <!-- Comment Body -->
        <div class="flex-1 min-w-0">
            <!-- Header -->
            <div class="flex items-center justify-between mb-1">
                <div class="flex items-center space-x-2 text-xs text-gray-500">
                    <span class="font-medium text-gray-700"><%= comment.user.name %></span>
                    <span><%= new Date(comment.createdAt).toLocaleDateString() %></span>
                    <% if (comment.createdAt.getTime() !== comment.updatedAt.getTime()) { %>
                        <span>(edited)</span>
                    <% } %>
                </div>
                
                <!-- Actions -->
                <% if (locals.user && comment.userId === user.id) { %>
                    <div class="dropdown dropdown-left">
                        <div tabindex="0" role="button" class="opacity-0 group-hover:opacity-100 hover:bg-gray-100 rounded p-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01"></path>
                            </svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-1 shadow bg-white rounded border text-xs w-32">
                            <li><a href="#" onclick="editComment('<%= comment.id %>')">Edit</a></li>
                            <li>
                                <a href="#" 
                                   hx-delete="/cards/<%= comment.cardId %>/comments/<%= comment.id %>"
                                   hx-target="#comment-<%= comment.id %>"
                                   hx-swap="outerHTML"
                                   hx-confirm="Delete comment?"
                                   class="text-error">Delete</a>
                            </li>
                        </ul>
                    </div>
                <% } %>
            </div>
            
            <!-- Content -->
            <div id="comment-content-<%= comment.id %>" class="text-sm text-gray-800 whitespace-pre-wrap">
                <%= comment.content %>
            </div>
            
            <!-- Edit Form -->
            <div id="comment-edit-<%= comment.id %>" class="hidden mt-2">
                <form hx-put="/cards/<%= comment.cardId %>/comments/<%= comment.id %>"
                      hx-target="#comment-<%= comment.id %>"
                      hx-swap="outerHTML"
                      class="space-y-2">
                    <textarea name="content" 
                              class="textarea textarea-bordered w-full h-16 text-sm" 
                              required
                              maxlength="2000"><%= comment.content %></textarea>
                    <div class="flex justify-end gap-1">
                        <button type="button" 
                                onclick="cancelEditComment('<%= comment.id %>')" 
                                class="btn btn-ghost btn-xs">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-xs">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function editComment(commentId) {
        document.getElementById('comment-content-' + commentId).classList.add('hidden');
        document.getElementById('comment-edit-' + commentId).classList.remove('hidden');
    }
    
    function cancelEditComment(commentId) {
        document.getElementById('comment-content-' + commentId).classList.remove('hidden');
        document.getElementById('comment-edit-' + commentId).classList.add('hidden');
    }
</script>